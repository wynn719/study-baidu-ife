define(["backbone","jquery","collections/tasks","common","zeptoTouch"],function(t,e,i,a){var s=t.View.extend({initialize:function(){this.taskCollection=i,this.$title=this.$(".app-title"),this.$editTitle=this.$(".edit-title"),this.$datetime=this.$(".task-datetime"),this.$editContent=this.$("#edit-content"),this.data={},this.listenTo(window.appRouter,"route:task",this.render),this.listenTo(this.taskCollection,"task_init",this.render),this.listenTo(this.taskCollection,"update_task_invalid",this.taskInvalid)},el:e("#task-view"),events:a.is_phone()?{swipeRight:"goBack","tap .app-title":"editTitle","blur .edit-title":"updateTaskTitle","blur #edit-content":"updateTaskContent","tap .back-btn":"goBack","tap .refresh-btn":"refreshPage"}:{"click .app-title":"editTitle","blur .edit-title":"updateTaskTitle","blur #edit-content":"updateTaskContent","click .back-btn":"goBack","click .refresh-btn":"refreshPage"},render:function(t){var e=this.taskCollection.findWhere({id:t});this.model=e,this.data={title:e.get("name"),created:e.get("created").substr(0,10),content:e.get("content"),cate:e.get("cate"),isFinished:e.get("is_finished")},this.$title.text(this.data.title),this.$editTitle.val(this.data.title),this.$datetime.text(this.data.created),this.$editContent.val(this.data.content)},editTitle:function(t){this.toggleTitleEdit(),this.$editTitle.focus()},toggleTitleEdit:function(){this.$title.toggleClass("hide"),this.$editTitle.toggleClass("hide")},updateTaskTitle:function(t){var e=this.$editTitle.val();this.$title.text(e),this.model.save({name:e}),this.toggleTitleEdit()},updateTaskContent:function(t){var e=this.$editContent.val();this.model.save({content:e})},goBack:function(t){t.preventDefault(),window.history.back()},refreshPage:function(t){t.preventDefault(),window.location.reload(!1)},taskInvalid:function(t,e){this.$title.text(this.data.title),this.$editTitle.val(this.data.title),alert(e)}});return s});