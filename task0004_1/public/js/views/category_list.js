define(["backbone","jquery","underscore","collections/categorys","views/category","common","collections/tasks","zeptoTouch"],function(e,t,a,o,n,i,d){var s=e.View.extend({initialize:function(){this.collection=o,this.tasksCollection=d,this.$AddCategoryModal=t("#new-category-modal"),this.$inputCateName=this.$AddCategoryModal.find(".cate-name"),this.$refreshBtn=this.$(".refresh-btn"),this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"reset",this.addAll),this.listenTo(this.collection,"all",this.render),this.listenTo(this.collection,"add_category_invalid",this.addInvalid),this.listenTo(this.tasksCollection,"increase",this.increaseTasksCount),this.listenTo(this.tasksCollection,"remove",this.decreaseTasksCount),this.collection.fetch()},el:t("#category-view"),events:i.is_phone()?{"tap #add-new-category":"showAddCategoryModal","tap #new-category-modal .ok-btn":"addOneCategory","tap #new-category-modal .unwrap-btn":"hideAddCategoryModal","tap .app-content":"hideAddCategoryModal","keypress #new-category-modal .cate-name":"addOnEnter","tap .refresh-btn":"refreshPage"}:{"click #add-new-category":"showAddCategoryModal","click #new-category-modal .ok-btn":"addOneCategory","click #new-category-modal .unwrap-btn":"hideAddCategoryModal","click .app-content":"hideAddCategoryModal","keypress #new-category-modal .cate-name":"addOnEnter","click .refresh-btn":"refreshPage"},render:function(){!this.collection.length},showAddCategoryModal:function(e){this.$AddCategoryModal.removeClass("hide"),this.$inputCateName.focus()},hideAddCategoryModal:function(e){this.$AddCategoryModal.addClass("hide"),this.$inputCateName.val("")},addOne:function(e){var t=new n({model:e});this.$("ul").append(t.render().el)},addAll:function(){this.collection.each(this.addOne,this)},addOneCategory:function(e){var t=this.$(".cate-name").val();t?this.collection.create({name:t}):this.collection.create(),this.hideAddCategoryModal()},addOnEnter:function(e){e.which===i.ENTER_KEY&&this.addOneCategory()},increaseTasksCount:function(e){var t=this.collection.findWhere({id:e});t.updateSubcateCount("add")},decreaseTasksCount:function(e){var t=e.get("cate"),a=this.collection.findWhere({id:t});a.updateSubcateCount("remove")},refreshPage:function(e){e.preventDefault(),window.location.reload(!1)},addInvalid:function(e,t){e.destroy(),alert(t)}});return s});